<!doctype html>

<html lang="pl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<style>
		.form-control.width-2 {
			width: 3em;
		}

		.form-control.width-4 {
			width: 5em;
		}

	</style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark ">
	<a class="navbar-brand mx-auto" href="#">Timestamp Converter</a>
	<div class="btn-group mx-auto my-2" role="group">
		<button type="button" class="btn btn-sm btn-primary" id="utc_button" onClick="UTCToggle('utc')">UTC</button>
		<button type="button" class="btn btn-sm btn-secondary" id="lt_button" onClick="UTCToggle('lt')">LT</button>
	</div>
</nav>
<div class="container">
	<div class="row">

		<div class="col-md my-3">
			<div class="card border-secondary">
				<div class="card-header border-0">
					Timestamp ➔ Date
					<button type="button" class="btn btn-sm btn-light btn-outline-secondary float-right"
									onclick="resetForms('timestamp')">Reset
					</button>
				</div>
				<div class="card-body">
					<form action="#" id="timestamp-form">
						<div class="input-group my-3">
							<input class="form-control form-control-lg" type="text" placeholder="timestamp"
										 id="timestamp-input"
										 maxlength="12">
							<div class="input-group-append">
								<button class="btn btn-secondary px-3" type="submit" id="goTimestamp">Go!</button>
							</div>
						</div>
					</form>

					<h2 class="mx-3 my-4" id="timestamp-to-date-result">&nbsp;</h2>

					<hr/>


					<div class="btn-group mx-2 my-2" role="group">
						<button type="button" class="btn btn-sm btn-secondary disabled">To start of</button>
						<button type="button" class="btn btn-sm btn-warning" onClick="toStartOfDay()">day</button>
						<button type="button" class="btn btn-sm btn-info" onClick="toStartOfMonth()">month</button>
						<button type="button" class="btn btn-sm btn-dark" onClick="toStartOfYear()">year</button>
					</div>


				</div>
			</div>
		</div>

		<div class="col-md my-3">
			<div class="card border-secondary">
				<div class="card-header border-0">
					Date ➔ Timestamp
					<button type="button" class="btn btn-sm btn-light btn-outline-secondary float-right"
									onclick="resetForms('date')">Reset
					</button>

				</div>
				<div class="card-body">
					<form action="#" id="date-form" class="form-inline">
						<div class="input-group my-3">
							<input type="text" class="form-control form-control-lg width-2" maxlength="2"
										 placeholder="D"
										 id="date-day">
							<input type="text" class="form-control form-control-lg width-2" maxlength="2"
										 placeholder="M"
										 id="date-month">
							<input type="text" class="form-control form-control-lg width-4" maxlength="5"
										 placeholder="Year"
										 id="date-year">
							<div class="input-group-append">
								<button class="btn btn-secondary px-3" type="submit" id="goDate">Go!</button>
							</div>
						</div>
						<button type="button" class="btn btn-warning mx-3" onclick="getToday()">Today</button>
					</form>

					<h2 class="mx-3 my-3" id="date-to-timestamp-result">&nbsp;</h2>

					<hr/>

					<div class="btn-group mx-2 my-2" role="group">
						<button type="button" class="btn btn-sm btn-warning px-3" onclick="crementoDay('-')">◀</button>
						<button type="button" class="btn btn-sm btn-warning disabled">Day</button>
						<button type="button" class="btn btn-sm btn-warning px-3" onclick="crementoDay('+')">▶</button>
					</div>

					<div class="btn-group mx-2" role="group">
						<button type="button" class="btn btn-sm btn-info px-3" onclick="crementoMonth('-')">◀</button>
						<button type="button" class="btn btn-sm btn-info disabled">Month</button>
						<button type="button" class="btn btn-sm btn-info px-3" onclick="crementoMonth('+')">▶</button>
					</div>

					<div class="btn-group mx-2 my-2" role="group">
						<button type="button" class="btn btn-sm btn-dark px-3" onclick="crementoYear('-')">◀</button>
						<button type="button" class="btn btn-sm btn-dark disabled">Year</button>
						<button type="button" class="btn btn-sm btn-dark px-3" onclick="crementoYear('+')">▶</button>
					</div>

				</div>
			</div>

		</div>
	</div>
</div>

<script>

  const ONE_DAY = 86400;

  function resetForms(type) {
    if (type === 'timestamp') {
      const input = document.getElementById('timestamp-input');
      input.value = '';
      input.focus();
    } else if (type === 'date') {
      const day = document.getElementById('date-day');
      const month = document.getElementById('date-month');
      const year = document.getElementById('date-year');
      day.value = '';
      month.value = '';
      year.value = '';
      day.focus();
    }
  }

  const timestampChanged = (e) => {
    e.preventDefault();
    const timestampValue = document.querySelector('#timestamp-input').value;
    const timestampToDateResult = document.querySelector('#timestamp-to-date-result');
    timestampToDateResult.innerHTML = timestampToDate(timestampValue);
  };

  // date to timestamp
  const dateChanged = (e) => {
    e.preventDefault();
    const day = document.querySelector('#date-day').value || 1;
    const month = (document.querySelector('#date-month').value || 1) - 1;
    const year = document.querySelector('#date-year').value || 1970;
    const dateToTimestamp = document.querySelector('#date-to-timestamp-result');
    // dateToTimestamp.innerHTML = `${day} - ${month} - ${year}`;
    // const newDate = `${month}/${day}/${year}`;
    dateToTimestamp.innerHTML = Date.UTC(year, month, day) / 1000;
  };

  // dodanie listenerów do inputu i do samego formularza
  document.getElementById('timestamp-form').addEventListener('submit', timestampChanged);
  document.getElementById('timestamp-input').addEventListener('keyup', timestampChanged);
  document.getElementById('timestamp-input').addEventListener('change', timestampChanged);
  document.getElementById('timestamp-input').focus();

  document.getElementById('date-form').addEventListener('submit', dateChanged);
  document.getElementById('date-year').addEventListener('change', dateChanged);

  const addLeadingZero = (number) => number < 10 ? `0${number}` : `${number}`;

  function timestampToDate(unix_timestamp) {
    const a = new Date(unix_timestamp * 1000);
    const months = ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'];
    const year = a.getUTCFullYear();
    const month = addLeadingZero(a.getUTCMonth() + 1); // +1, because returns month from 0
    const date = a.getUTCDate();
    const hour = a.getUTCHours();
    const min = addLeadingZero(a.getUTCMinutes());
    const sec = addLeadingZero(a.getUTCSeconds());
    return `${date}.${month}.${year} ${hour}:${min}:${sec}`;
  }

  function toStartOfDay() {
    const timestampInput = document.getElementById('timestamp-input');
    timestampInput.value = timestampInput.value - timestampInput.value % ONE_DAY;
    document.getElementById('goTimestamp').click();
  }

  function toStartOfMonth() {
    const timestampInput = document.getElementById('timestamp-input');
    const a = new Date(timestampInput.value * 1000);
    const month = a.getUTCMonth();
    const year = a.getUTCFullYear();
    timestampInput.value = Date.UTC(year, month) / 1000;
    document.getElementById('goTimestamp').click();
  }

  function toStartOfYear() {
    const timestampInput = document.getElementById('timestamp-input');
    const a = new Date(timestampInput.value * 1000);
    const year = a.getUTCFullYear();
    timestampInput.value = Date.UTC(year, 0) / 1000;
    document.getElementById('goTimestamp').click();
  }

  // day, month and year -> increment, decrement

  function cremento(element, type, min, max) {
    let value = (parseInt(element.value) || 1);
    value += (type === '+') ? +1 : -1;
    if (value >= min && value <= max) {
      element.value = value;
    }
    if (min === max) element.value = value; // gdy nie chcemy limitów, np w przypadku roku
    document.getElementById('goDate').click();
  }

  function crementoDay(type) {
    const element = document.getElementById('date-day');
    cremento(element, type, 1, 31);
  }

  function crementoMonth(type) {
    const element = document.getElementById('date-month');
    cremento(element, type, 1, 12);
  }

  function crementoYear(type) {
    const element = document.getElementById('date-year');
    cremento(element, type, 0, 0);
  }


  ////// kolorowanie przycisków utc i LT
  function highlightUTCButton(type) {
    const secondary = type === 'utc_button' ? 'lt_button' : 'utc_button';
    const primaryButton = document.getElementById(type);
    primaryButton.classList.remove('btn-secondary');
    primaryButton.classList.add('btn-primary');
    const secondaryButton = document.getElementById(secondary);
    secondaryButton.classList.remove('btn-primary');
    secondaryButton.classList.add('btn-secondary');
  }

  function UTCToggle(type) {
    if (type === 'utc') {
      highlightUTCButton('utc_button');
    }
    if (type === 'lt') {
      highlightUTCButton('lt_button');
    }
  }

  // // przycisk NOW // //
  function getToday() {
    const now = new Date();
    document.getElementById('date-day').value = now.getUTCDate();
    document.getElementById('date-month').value = addLeadingZero(now.getUTCMonth() + 1);
    document.getElementById('date-year').value = now.getUTCFullYear();
    document.getElementById('goDate').click();
  }

</script>


</body>
</html>